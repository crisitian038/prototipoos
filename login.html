<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Acceso — Red Educativa México</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{
            --azul-oscuro:#0a2e5a;
            --azul-medio:#0056a6;
            --logo-teal:#27F5DA;
            --bg:#e9f6f9;
            --panel:#ffffffcc;
            --muted:#6b7280;
            --glass-border: rgba(255,255,255,0.6);
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;margin:0;background:
            linear-gradient(135deg, #e6f9f8 0%, #f3f7ff 55%, #eaf6ff 100%),
            repeating-linear-gradient(135deg, rgba(255,255,255,0.03) 0 2px, rgba(255,255,255,0) 2px 8px);
            color:var(--azul-oscuro);-webkit-font-smoothing:antialiased;position:relative;overflow-y:auto}

        /* floating blurred shapes for depth + subtle pattern */
        body::before, body::after{
            content:'';position:fixed;inset:0;pointer-events:none;z-index:0;filter:blur(40px);opacity:0.5;
        }
        body::before{background:radial-gradient(circle at 10% 20%, rgba(39,245,218,0.18), transparent 14%), radial-gradient(circle at 90% 80%, rgba(10,46,90,0.08), transparent 20%)}
        body::after{background:linear-gradient(120deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0) 30%), radial-gradient(circle at 20% 85%, rgba(2,24,63,0.04), transparent 25%)}

        .wrap{max-width:920px;margin:6vh auto;padding:28px 20px;position:relative;z-index:2}
        .header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
        .header img{height:56px;filter:drop-shadow(0 6px 18px rgba(2,24,63,0.12))}
        .brand{font-weight:800;font-size:1.15rem}
        .brand .helper{font-weight:600;font-size:0.85rem;color:var(--muted)}

        /* frosted card */
        .panel{background:var(--panel);backdrop-filter:blur(8px) saturate(120%);-webkit-backdrop-filter:blur(8px);padding:26px;border-radius:14px;box-shadow:0 18px 50px rgba(2,24,63,0.12);border:1px solid rgba(255,255,255,0.6);position:relative;overflow:hidden}
        .panel::after{content:'';position:absolute;inset:0;pointer-events:none;background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00) 30%);mix-blend-mode:overlay;border-radius:14px}

        .tabs{display:flex;gap:12px;margin-bottom:16px}
        .tab{padding:10px 16px;border-radius:999px;border:1px solid rgba(10,46,90,0.06);cursor:pointer;background:transparent;color:var(--azul-oscuro);font-weight:700;transition:all .22s}
        .tab.active{background:linear-gradient(90deg,var(--logo-teal),#a6fff6);color:var(--azul-oscuro);transform:translateY(-2px);box-shadow:0 8px 20px rgba(39,245,218,0.12);border-color:transparent}

        form{display:grid;gap:14px;max-width:560px}
        .form-group{display:flex;flex-direction:column;gap:8px}

        input[type=text],input[type=email],input[type=password]{padding:12px 14px;border-radius:10px;border:1px solid rgba(10,46,90,0.08);background:rgba(255,255,255,0.8);transition:all .18s;outline:none;font-size:0.98rem}
        input[type:text]:focus,input[type=email]:focus,input[type=password]:focus{box-shadow:0 8px 30px rgba(2,24,63,0.08);border-color:rgba(39,245,218,0.6)}

        .btn{padding:12px 16px;background:linear-gradient(90deg,var(--logo-teal),#8ef1e7);color:var(--azul-oscuro);border:none;border-radius:10px;cursor:pointer;font-weight:800;box-shadow:0 10px 30px rgba(39,245,218,0.08);transition:transform .16s,box-shadow .16s}
        .btn:hover{transform:translateY(-3px);box-shadow:0 18px 40px rgba(39,245,218,0.14)}

        .muted{color:var(--muted);font-size:0.95rem}
        .form-success{display:none;padding:12px;border-radius:10px;background:rgba(39,245,218,0.14);color:var(--azul-oscuro);font-weight:700}
        .form-error{display:none;padding:12px;border-radius:10px;background:#ffecec;color:#6b0b00;font-weight:700}

        /* helper text */
        .helper{font-size:0.9rem;color:var(--muted)}

        /* small responsive tweaks */
        @media (max-width:760px){
            .wrap{margin:4vh 16px}
            .panel{padding:18px}
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="header">
            <img src="logo.png" alt="logo">
            <div class="brand">Red Educativa México <div class="helper">Acceso / Registro</div></div>
        </div>

        <div class="panel">
            <div class="tabs">
                <button id="tabLogin" class="tab active">Iniciar sesión</button>
                <button id="tabRegister" class="tab">Registrarse</button>
            </div>

            <div id="messages">
                <div id="msgSuccess" class="form-success" role="status" aria-live="polite"></div>
                <div id="msgError" class="form-error" role="alert"></div>
            </div>

            <div id="loginBox">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Correo electrónico</label>
                        <input id="loginEmail" type="email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Contraseña</label>
                        <input id="loginPassword" type="password" required minlength="6">
                    </div>
                    <div style="display:flex;gap:8px;align-items:center">
                        <button class="btn" type="submit">Acceder</button>
                        <div class="muted">Si tienes cuenta, inicia sesión aquí.</div>
                    </div>
                </form>
            </div>

            <div id="registerBox" style="display:none;margin-top:8px">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="regName">Nombre completo</label>
                        <input id="regName" type="text" required>
                    </div>
                    <div class="form-group">
                        <label for="regEmail">Correo electrónico</label>
                        <input id="regEmail" type="email" required>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Contraseña (mín. 6)</label>
                        <input id="regPassword" type="password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="regPassword2">Repetir contraseña</label>
                        <input id="regPassword2" type="password" required minlength="6">
                    </div>
                    <div style="display:flex;gap:8px;align-items:center">
                        <button class="btn" type="submit">Crear cuenta</button>
                        <div class="muted">Registraremos tu cuenta en la base local (demo).</div>
                    </div>
                </form>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/pouchdb@7.3.0/dist/pouchdb.min.js"></script>
    <script>
        // helper: SHA-256 hex
        async function sha256Hex(str){
            const enc = new TextEncoder();
            const data = enc.encode(str);
            const hash = await crypto.subtle.digest('SHA-256', data);
            const arr = Array.from(new Uint8Array(hash));
            return arr.map(b=>b.toString(16).padStart(2,'0')).join('');
        }

        document.addEventListener('DOMContentLoaded', function(){
            const tabLogin = document.getElementById('tabLogin');
            const tabRegister = document.getElementById('tabRegister');
            const loginBox = document.getElementById('loginBox');
            const registerBox = document.getElementById('registerBox');
            const msgSuccess = document.getElementById('msgSuccess');
            const msgError = document.getElementById('msgError');

            function showSuccess(txt){ msgSuccess.textContent = txt; msgSuccess.style.display = 'block'; setTimeout(()=>msgSuccess.style.display='none',6000); }
            function showError(txt){ msgError.textContent = txt; msgError.style.display = 'block'; setTimeout(()=>msgError.style.display='none',8000); }

            tabLogin.addEventListener('click', ()=>{ tabLogin.classList.add('active'); tabRegister.classList.remove('active'); loginBox.style.display='block'; registerBox.style.display='none'; });
            tabRegister.addEventListener('click', ()=>{ tabRegister.classList.add('active'); tabLogin.classList.remove('active'); registerBox.style.display='block'; loginBox.style.display='none'; });

            // init PouchDB for users
            let db = null;
            if (window.PouchDB) db = new PouchDB('rem-users');

            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');

            loginForm.addEventListener('submit', async function(e){
                e.preventDefault();
                const email = document.getElementById('loginEmail').value.trim().toLowerCase();
                const password = document.getElementById('loginPassword').value;
                if (!email || !password) return showError('Completa email y contraseña.');
                if (!db) return showError('Base de datos no disponible.');
                try{
                    const id = 'user_' + encodeURIComponent(email);
                    const doc = await db.get(id);
                    const hash = await sha256Hex(password);
                    if (doc.passwordHash === hash){
                        // success: set session key and redirect to admin
                        localStorage.setItem('rem-user', id);
                        showSuccess('Acceso correcto. Redirigiendo...');
                        setTimeout(()=>{ window.location.href = './admin.html'; }, 800);
                    } else {
                        showError('Credenciales incorrectas.');
                    }
                }catch(err){
                    showError('Usuario no encontrado. Por favor regístrate.');
                }
            });

            registerForm.addEventListener('submit', async function(e){
                e.preventDefault();
                const name = document.getElementById('regName').value.trim();
                const email = document.getElementById('regEmail').value.trim().toLowerCase();
                const pw = document.getElementById('regPassword').value;
                const pw2 = document.getElementById('regPassword2').value;
                if (!name || !email || !pw) return showError('Completa todos los campos.');
                if (pw !== pw2) return showError('Las contraseñas no coinciden.');
                if (!db) return showError('Base de datos no disponible.');
                try{
                    const id = 'user_' + encodeURIComponent(email);
                    // check exists
                    const existing = await db.get(id).catch(()=>null);
                    if (existing) return showError('Ya existe una cuenta con ese correo.');
                    const hash = await sha256Hex(pw);
                    const doc = { _id: id, name: name, email: email, passwordHash: hash, createdAt: new Date().toISOString() };
                    await db.put(doc);
                    showSuccess('Cuenta creada. Ya puedes iniciar sesión.');
                    registerForm.reset();
                    tabLogin.click();
                }catch(err){
                    console.error(err);
                    showError('Error al crear la cuenta.');
                }
            });
        });
    </script>
</body>
</html>
